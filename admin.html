<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê´€ë¦¬ì í˜ì´ì§€</title>
  <link rel="stylesheet" href="style.css">
</head>

<body class="bg">

<h1 style="text-align:center;">ê´€ë¦¬ì ë­í‚¹ ê´€ë¦¬</h1>

<div style="text-align:center; margin-bottom:30px;">
  <input id="playerName" placeholder="ë‹‰ë„¤ì„ (ì˜ˆ: ëšœì´#1234)">
  <button id="addPlayer">í”Œë ˆì´ì–´ ì¶”ê°€</button>
</div>

<table border="1" style="margin:auto; text-align:center;">
  <thead>
    <tr>
      <th>ë‹‰ë„¤ì„</th>
      <th>ìŠ¹</th>
      <th>íŒ¨</th>
      <th>ì ìˆ˜</th>
      <th>ê´€ë¦¬</th>
    </tr>
  </thead>
  <tbody id="adminTable"></tbody>
</table>


<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script src="firebase.js"></script>

<script>

const ADMIN_UID = "ì—¬ê¸°ì—ë„¤UID"; // ğŸ”¥ ë„¤ UID ë„£ì–´ë¼

// ë¡œê·¸ì¸ í™•ì¸
auth.onAuthStateChanged(user => {
  if (!user) {
    alert("ë¡œê·¸ì¸ í•„ìš”");
    location.href = "login.html";
    return;
  }

  if (user.uid !== ADMIN_UID) {
    alert("ê´€ë¦¬ìë§Œ ì ‘ê·¼ ê°€ëŠ¥");
    location.href = "index.html";
    return;
  }

  loadPlayers();
});

// í”Œë ˆì´ì–´ ì¶”ê°€
document.getElementById("addPlayer").onclick = function() {

  const name = document.getElementById("playerName").value.trim();
  if (!name) return alert("ë‹‰ë„¤ì„ ì…ë ¥");

  const newRef = database.ref("rankings").push();

  newRef.set({
    name: name,
    wins: 0,
    losses: 0,
    score: 0
  });

  document.getElementById("playerName").value = "";
};


// í”Œë ˆì´ì–´ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
function loadPlayers() {

  database.ref("rankings").on("value", snapshot => {

    const table = document.getElementById("adminTable");
    table.innerHTML = "";

    snapshot.forEach(child => {

      const data = child.val();
      const key = child.key;

      table.innerHTML += `
        <tr>
          <td>${data.name}</td>
          <td>${data.wins}</td>
          <td>${data.losses}</td>
          <td>${data.score}</td>
          <td>
            <button onclick="addWin('${key}', ${data.wins}, ${data.losses})">ìŠ¹ +1</button>
            <button onclick="addLoss('${key}', ${data.wins}, ${data.losses})">íŒ¨ +1</button>
            <button onclick="deletePlayer('${key}')">ì‚­ì œ</button>
          </td>
        </tr>
      `;

    });

  });
}


// ìŠ¹ ì¶”ê°€
function addWin(key, wins, losses) {

  wins++;
  const score = wins * 5 - losses * 3;

  database.ref("rankings/" + key).update({
    wins: wins,
    score: score
  });
}


// íŒ¨ ì¶”ê°€
function addLoss(key, wins, losses) {

  losses++;
  const score = wins * 5 - losses * 3;

  database.ref("rankings/" + key).update({
    losses: losses,
    score: score
  });
}


// ì‚­ì œ
function deletePlayer(key) {
  if (!confirm("ì‚­ì œí• ê¹Œ?")) return;
  database.ref("rankings/" + key).remove();
}

</script>

</body>
</html>
