<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>게시판 - 호그 주먹전</title>
<link rel="stylesheet" href="style.css">
</head>
<body class="bg">
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyA0nV1kSuJFiMDM9WV2vDAqGiXp6jPcsm4",
    authDomain: "hogboxing-35911.firebaseapp.com",
    projectId: "hogboxing-35911",
    storageBucket: "hogboxing-35911.appspot.com",
    messagingSenderId: "911173936135",
    appId: "1:911173936135:web:a34c9c81ab4ce23645f6a2"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();

  // 로그인 상태 감지
  auth.onAuthStateChanged(user => {
    const loginMenu = document.getElementById("loginMenu");
    const userMenu = document.getElementById("userMenu");
    const userName = document.getElementById("userName");

    if (!loginMenu || !userMenu) return;

    if (user) {
      loginMenu.style.display = "none";
      userMenu.style.display = "inline";

      userName.textContent = user.displayName || user.email;
    } else {
      loginMenu.style.display = "inline";
      userMenu.style.display = "none";
    }
  });

  // 로그아웃
  document.addEventListener("click", e => {
    if (e.target.id === "logoutBtn") {
      e.preventDefault();
      auth.signOut().then(() => {
        alert("로그아웃 되었습니다.");
        location.href = "index.html";
      });
    }
  });
</script>

<header class="nav">
  <div class="nav-inner">
    <a href="index.html" class="logo">Hog Boxing</a>
    <nav class="menu">
      <a href="index.html">홈</a>
      <a href="ranking.html">랭킹</a>
      <a href="board.html">게시판</a>
    
      <!-- 로그인 전 -->
      <a href="login.html" id="loginMenu">로그인</a>
    
      <!-- 로그인 후 -->
      <span id="userMenu" style="display:none;">
        <span id="userName" style="margin-right:10px;"></span>
        <a href="#" id="logoutBtn">로그아웃</a>
      </span>
    </nav>
  </div>
</header>

<div class="board-container">
  <div class="board-header">
    <h2>전체 글 목록</h2>
    <button class="write-btn" onclick="location.href='writePost.html'">글쓰기</button>
  </div>

  <table class="board-table">
    <thead>
      <tr>
        <th style="width:60px;">번호</th>
        <th>제목</th>
        <th style="width:150px;">작성자</th>
        <th style="width:150px;">작성일</th>
        <th style="width:80px;">조회</th>
      </tr>
    </thead>
    <tbody id="postList"></tbody>
  </table>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase.js"></script>

<script>
async function loadPosts() {
  const snapshot = await firebase.database().ref("posts").get();
  const posts = [];

  snapshot.forEach((child) => {
    posts.push({ key: child.key, ...child.val() });
  });

  posts.sort((a, b) => {
    return new Date(b.createdAt) - new Date(a.createdAt);
  });

  const tbody = document.getElementById("postList");
  tbody.innerHTML = "";

  posts.forEach((post,index)=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${index+1}</td>
      <td><a href="#">${post.title}</a></td>
      <td>${post.author}</td>
      <td>${post.createdAt}</td>
      <td id="views-${post.key}">${post.views || 0}</td>
    `;
    tbody.appendChild(tr);

    tr.querySelector("a").addEventListener("click", async (e)=>{
      e.preventDefault();
      const postRef = firebase.database().ref("posts/" + post.key + "/views");
      const snap = await postRef.get();
      const currentViews = snap.exists() ? snap.val() : 0;
      await postRef.set(currentViews + 1);

      document.getElementById(`views-${post.key}`).textContent = currentViews + 1;

      window.location.href = `viewPost.html?title=${encodeURIComponent(post.title)}&author=${encodeURIComponent(post.author)}&createdAt=${encodeURIComponent(post.createdAt)}&content=${encodeURIComponent(post.content)}`;
    });
  });
}

document.addEventListener("DOMContentLoaded", loadPosts);
</script>
</body>
</html>


