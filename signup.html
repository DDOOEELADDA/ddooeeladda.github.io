<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>회원가입</title>
  <link rel="stylesheet" href="style.css">

  <!-- Firebase (compat) -->
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
</head>

<body class="bg">

<header class="nav">
  <div class="nav-inner">
    <a href="index.html" class="logo">Hog Boxing</a>
    <nav class="menu">
      <a href="index.html">홈</a>
      <a href="ranking.html">랭킹</a>
      <a href="board.html">게시판</a>

      <!-- 로그인 전 -->
      <a href="login.html" id="loginMenu">로그인</a>

      <!-- 로그인 후 -->
      <span id="userMenu" style="display:none;">
        <span id="userName" style="margin-left:15px; margin-right:1px;"></span>
        <a href="#" id="logoutBtn">로그아웃</a>
      </span>
    </nav>
  </div>
</header>

<div class="page-container" style="max-width:500px;">
  <h1 class="page-title">회원가입</h1>

  <input class="input" id="email" placeholder="이메일">
  <input class="input" id="nickname" placeholder="닉네임">
  <input class="input" id="password" type="password" placeholder="비밀번호">

  <button class="btn-primary" id="signupBtn">회원가입</button>

  <hr style="border-color:#333; margin:25px 0;">

  <button class="btn-outline" id="googleSignup">Google로 가입하기</button>
</div>

<script>
  // Firebase 설정
  const firebaseConfig = {
    apiKey: "AIzaSyA0nV1kSuJFiMDM9WV2vDAqGiXp6jPcsm4",
    authDomain: "hogboxing-35911.firebaseapp.com",
    projectId: "hogboxing-35911",
    storageBucket: "hogboxing-35911.appspot.com",
    messagingSenderId: "911173936135",
    appId: "1:911173936135:web:a34c9c81ab4ce23645f6a2"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const auth = firebase.auth();

  /* ===============================
     0️⃣ 로그인된 사용자 접근 차단
  =============================== */
  auth.onAuthStateChanged(user => {
    const loginMenu = document.getElementById("loginMenu");
    const userMenu = document.getElementById("userMenu");
    const userName = document.getElementById("userName");

    if (user) {
      // 상단 UI
      loginMenu.style.display = "none";
      userMenu.style.display = "inline";
      userName.textContent = `[${user.displayName || user.email}]`;

      // 이미 로그인 상태면 접근 차단
      alert("이미 로그인되어 있습니다.");
      window.location.replace("index.html");
    } else {
      loginMenu.style.display = "inline";
      userMenu.style.display = "none";
    }
  });

  /* ===============================
     1️⃣ 이메일 회원가입
  =============================== */
  document.getElementById("signupBtn").onclick = async () => {
    const email = document.getElementById("email").value.trim();
    const nickname = document.getElementById("nickname").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!email || !nickname || !password) {
      alert("모든 항목을 입력해주세요.");
      return;
    }

    try {
      // 계정 생성
      const result = await auth.createUserWithEmailAndPassword(email, password);

      // 닉네임 저장
      await result.user.updateProfile({
        displayName: nickname
      });

      // 이메일 인증 메일 전송
      await result.user.sendEmailVerification();

      alert(
        "회원가입이 완료되었습니다!\n\n\n" +
        "이메일로 인증 링크가 전송되었습니다.\n\n" +
        "스팸 메일 확인 부탁드립니다.\n" +
        "인증 후 로그인해주세요."
      );

      // 인증 전에는 로그인 차단
      await auth.signOut();
      window.location.href = "login.html";

    } catch (error) {
      console.error(error);
      alert("회원가입 오류: " + error.message);
    }
  };

  /* ===============================
     2️⃣ Google 회원가입
  =============================== */
  document.getElementById("googleSignup").onclick = () => {
    const provider = new firebase.auth.GoogleAuthProvider();

    auth.signInWithPopup(provider)
      .then(() => {
        alert("Google 회원가입 완료!");
        window.location.href = "index.html";
      })
      .catch(err => {
        console.error(err);
        alert("오류: " + err.message);
      });
  };

  /* ===============================
     3️⃣ 로그아웃
  =============================== */
  document.addEventListener("click", e => {
    if (e.target.id === "logoutBtn") {
      e.preventDefault();
      auth.signOut().then(() => {
        alert("로그아웃 되었습니다.");
        location.reload();
      });
    }
  });
</script>

</body>
</html>

