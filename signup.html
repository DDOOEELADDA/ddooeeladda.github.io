<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>회원가입</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="bg">

<header class="nav">
  <div class="nav-inner">
    <a href="index.html" class="logo">Hog Boxing</a>
    <nav class="menu">
      <a href="index.html">홈</a>
      <a href="ranking.html">랭킹</a>
      <a href="board.html">게시판</a>
      <a href="login.html">로그인</a>
    </nav>
  </div>
</header>

<div class="page-container" style="max-width:500px;">
  <h1 class="page-title">회원가입</h1>

  <input class="input" id="email" placeholder="이메일">
  <input class="input" id="nickname" placeholder="닉네임">
  <input class="input" id="password" type="password" placeholder="비밀번호">

  <button class="btn-primary" id="signupBtn">회원가입</button>

  <hr style="border-color:#333; margin:25px 0;">

  <button class="btn-outline" id="googleSignup">Google로 가입하기</button>
</div>


<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="firebase.js"></script>

<script>
// Firestore 선언
const db = firebase.firestore();

// 이메일 + 비밀번호 회원가입
document.getElementById("signupBtn").onclick = async function () {
  const email = document.getElementById("email").value.trim();
  const nickname = document.getElementById("nickname").value.trim();
  const pw = document.getElementById("password").value.trim();

  if (!email || !nickname || !pw) {
    alert("모든 필드를 입력하세요.");
    return;
  }

  try {
    // Firebase Auth 가입
    const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, pw);
    const user = userCredential.user;

    // Firestore에 닉네임 저장 (users/{uid})
    await db.collection("users").doc(user.uid).set({
      email: email,
      nickname: nickname,
      createdAt: new Date()
    });

    alert("회원가입 완료! 자동 로그인됩니다.");
    location.href = "index.html";

  } catch (error) {
    alert("회원가입 오류: " + error.message);
  }
};


// Google 로그인/회원가입
document.getElementById("googleSignup").onclick = async function () {
  const provider = new firebase.auth.GoogleAuthProvider();

  try {
    const result = await firebase.auth().signInWithPopup(provider);
    const user = result.user;

    // Firestore에 사용자 정보 없으면 생성
    const userDoc = await db.collection("users").doc(user.uid).get();

    if (!userDoc.exists) {
      await db.collection("users").doc(user.uid).set({
        email: user.email,
        nickname: user.displayName || "GoogleUser",
        createdAt: new Date()
      });
    }

    alert("Google 로그인 성공!");
    location.href = "index.html";

  } catch (error) {
    alert("Google 로그인 실패: " + error.message);
  }
};
</script>

</body>
</html>
