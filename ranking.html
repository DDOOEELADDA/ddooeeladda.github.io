<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>๋ญํน - ํธ๊ทธ ์ฃผ๋จน์</title>
  <link rel="stylesheet" href="style.css">
</head>

<body class="bg">

<header class="nav">
  <div class="nav-inner">
    <a href="index.html" class="logo">Hog Boxing</a>
    <nav class="menu">
      <a href="index.html">ํ</a>
      <a href="ranking.html">๋ญํน</a>
      <a href="board.html">๊ฒ์ํ</a>

      <!-- ๋ก๊ทธ์ธ ์ -->
      <a href="login.html" id="loginMenu">๋ก๊ทธ์ธ</a>

      <!-- ๋ก๊ทธ์ธ ํ -->
      <span id="userMenu" style="display:none;">
      <span id="userName" style="margin-left:15px; margin-right:1px;"></span>
        <a href="#" id="logoutBtn">๋ก๊ทธ์์</a>
      </span>
    </nav>
  </div>
</header>

<div class="page-container">
  <h1 class="page-title">ํ๋์ด์ด ๋ญํน</h1>

  <table class="table" id="rankingTable">
    <thead>
      <tr>
        <th>์์</th>
        <th>๋๋ค์</th>
        <th>์์</th>
      </tr>
    </thead>
    <tbody>
      <!-- ์ถํ Firebase ๋ญํน ๋ฐ์ดํฐ -->
    </tbody>
  </table>
  <br><br>

<button id="searchBtn">๐ ๊ฒ์</button>

<div id="searchBox" style="display:none; margin-top:15px;">
  <input id="searchInput" placeholder="๋๋ค์ ์๋ฅ(๋์๋ฌธ์ ๊ตฌ๋ถ, ํ๋ค์)">
  <button id="doSearch">ํ์ธ</button>
</div>

<div id="searchResult" style="margin-top:15px;"></div>
</div>



<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Firebase ์ด๊ธฐํ -->
<script src="firebase.js"></script>

<script>
  // ๋ก๊ทธ์ธ ์ํ ๊ฐ์ง
  auth.onAuthStateChanged(user => {
    const loginMenu = document.getElementById("loginMenu");
    const userMenu = document.getElementById("userMenu");
    const userName = document.getElementById("userName");

    if (!loginMenu || !userMenu) return;

    if (user) {
      loginMenu.style.display = "none";
      userMenu.style.display = "inline";
      const name = user.displayName || user.email;
      userName.textContent = `[${name}]`;
    } else {
      loginMenu.style.display = "inline";
      userMenu.style.display = "none";
    }
  });

// ๋ก๊ทธ์์
document.addEventListener("click", e => {
  if (e.target.id === "logoutBtn") {
    e.preventDefault();

    // ๋ก๊ทธ์์ ํ์ธ
    const confirmLogout = confirm("๋ก๊ทธ์์ ํ์๊ฒ์ต๋๊น?");
    if (confirmLogout) {
      auth.signOut().then(() => {
        alert("๋ก๊ทธ์์ ๋์์ต๋๋ค.");
        location.reload();
      }).catch((error) => {
        console.error("๋ก๊ทธ์์ ์คํจ:", error);
        alert("๋ก๊ทธ์์ ์ค ์ค๋ฅ๊ฐ ๋ฐ์ํ์ต๋๋ค.");
      });
    }
  }
});
</script>
<script>
// ๊ฒ์์ฐฝ ์ด๊ธฐ
document.getElementById("searchBtn").onclick = function() {
  const box = document.getElementById("searchBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
};

// ๊ฒ์ ์คํ
document.getElementById("doSearch").onclick = function() {

  const name = document.getElementById("searchInput").value.trim();
  const resultDiv = document.getElementById("searchResult");

  if (!name) return;

  database.ref("rankings")
    .orderByChild("name")
    .equalTo(name)
    .once("value")
    .then(snapshot => {

      if (!snapshot.exists()) {
        resultDiv.innerText = "ํด๋น ํ๋์ด์ด ์์";
        return;
      }

      snapshot.forEach(child => {
        const player = child.val();
        resultDiv.innerHTML = `
          ๋๋ค์: ${player.name}<br>
          ์์: ${player.score}<br>
          ์น: ${player.wins}<br>
          ํจ: ${player.losses}
        `;
      });

    });
};
const rankingTableBody = document.querySelector("#rankingTable tbody");

function loadTop5() {
  database.ref("rankings")
    .orderByChild("score")
    .limitToLast(5)
    .on("value", snapshot => {

      rankingTableBody.innerHTML = "";

      const data = [];

      snapshot.forEach(child => {
        data.push(child.val());
      });

      // ์์ ๋์ ์ ์๋ฌ
      data.sort((a,b) => b.score - a.score);

      data.forEach((player, index) => {
        const row = `
          <tr>
            <td>${index + 1}</td>
            <td>${player.name}</td>
            <td>${player.score}</td>
          </tr>
        `;
        rankingTableBody.innerHTML += row;
      });

    });
}

loadTop5();
</script>

</body>
</html>





