<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ê¸€ì“°ê¸° - í˜¸ê·¸ ì£¼ë¨¹ì „</title>
<link rel="stylesheet" href="style.css">
</head>

<body class="bg">

<header class="nav">
  <div class="nav-inner">
    <a href="index.html" class="logo">Hog Boxing</a>
    <nav class="menu">
      <a href="index.html">í™ˆ</a>
      <a href="ranking.html">ë­í‚¹</a>
      <a href="board.html">ê²Œì‹œíŒ</a>

      <!-- ë¡œê·¸ì¸ ì „ -->
      <a href="login.html" id="loginMenu">ë¡œê·¸ì¸</a>

      <!-- ë¡œê·¸ì¸ í›„ -->
      <span id="userMenu" style="display:none;">
        <span id="userName" style="margin-right:10px;"></span>
        <a href="#" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</a>
      </span>
    </nav>
  </div>
</header>

<div class="page-container">
  <h1 class="page-title">ê¸€ì“°ê¸°</h1>

  <input class="input" id="titleInput" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
  <textarea class="textarea" id="contentInput" placeholder="ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>

  <button class="btn-primary" id="postSubmit">ë“±ë¡í•˜ê¸°</button>
  <a href="board.html" class="btn-outline" style="margin-left:20px;">ì·¨ì†Œ</a>
</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<!-- Firebase ì´ˆê¸°í™” -->
<script src="firebase.js"></script>

<script>
let currentUser = null;

/* ===============================
   ë¡œê·¸ì¸ ìƒíƒœ ê°ì§€ + ë©”ë‰´ ì²˜ë¦¬
================================ */
firebase.auth().onAuthStateChanged(user => {
  currentUser = user;

  const loginMenu = document.getElementById("loginMenu");
  const userMenu = document.getElementById("userMenu");
  const userName = document.getElementById("userName");

  if (user) {
    loginMenu.style.display = "none";
    userMenu.style.display = "inline";
    userName.textContent = `[${user.displayName || user.email}]`;
  } else {
    loginMenu.style.display = "inline";
    userMenu.style.display = "none";
  }
});

/* ===============================
   ë¡œê·¸ì•„ì›ƒ
================================ */
document.addEventListener("click", e => {
  if (e.target.id === "logoutBtn") {
    e.preventDefault();
    firebase.auth().signOut().then(() => {
      location.reload();
    });
  }
});

/* ===============================
   ê¸€ ë“±ë¡
================================ */
document.getElementById("postSubmit").onclick = async () => {
  const title = document.getElementById("titleInput").value.trim();
  const content = document.getElementById("contentInput").value.trim();

  if (!title || !content) {
    alert("ì œëª©ê³¼ ë‚´ìš©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    return;
  }

  // ğŸ”¥ ì‘ì„±ì ì •ë³´
  let author = "Boxer";
  let authorUid = null;

  if (currentUser) {
    author = currentUser.displayName || currentUser.email;
    authorUid = currentUser.uid;
  }

  const postData = {
    title,
    content,
    author,
    authorUid,          // â­ ì‚­ì œ ê¶Œí•œ íŒë³„ìš©
    createdAt: new Date().toLocaleString(),
    views: 0
  };

  try {
    await firebase.database().ref("posts").push(postData);
    alert("ê¸€ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!");
    location.href = "board.html";
  } catch (e) {
    console.error(e);
    alert("ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
};
</script>

</body>
</html>
